<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns = "http://www.w3.org/1999/xhtml">
<head>
	<title>YouDeliberate!</title>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<style type="text/css">
		body{
			background-color:black;
		}
		#header{
			background-color:darkblue;
			width:98%;
			font-family:helvetica;
			font-size:3.5vh;
			font-weight:bolder;
			height:5%;
			position:absolute;
			text-align:center;
			vertical-align: top;
			padding-top:1%;
			left:1%;
			border-radius:50%;
		}
		#side{
		}
		#content{
			background-color:blue;
			font-family:arial;
			font-size:2em;
			width:93%;
			height:84.5%;
			padding-left:5%;
			position:absolute;
			top:8.5%;
			left:1%;
			border-radius:7%;
		}
		#footer{
			font-family:arial;
			font-size:0.8em;
			background-color:darkblue;
			width:98%;
			height:5%;
			color:white;
			position:absolute;
			top:94%;
			left:1%;
			text-align:center;  
			border-radius:50%;
			<!--vertical-align:middle; 
			display:table-cell;   -->
			
		}
		.booktitle{
			font-size:1.6em;
		}
		.cart{
			font-size:0.7em;
			float:right;	
		}
		.item{
			display:inline-block;
			width:60%;
		}
	</style>
</head>
<body>

<div>	
	<div id="header">
		YouDeliberate!
		<br />
	</div>
	
	<br />
	
	<!--<div id="side">
		<div id="eye"style="left:40%;position:absolute;width:100%;height:100%">
			<img src="images/eye.png" alt="eye" width=20% height=10%/>
		</div>
		<div id="clock"style="left:45%;position:absolute;width:100%;height:100%">
			<img src="images/clock.png" alt="clock" width=10% height=10%/>
		</div>
		<div id="thumbs-up"style="top:47%;position:absolute;width:100%;height:100%">
			<img src="images/thumbs-up.png" alt="thumbs-up" width=10% height=10%/>
		</div>
		<div id="thumbs-down"style="top:47%;position:absolute;width:100%;height:100%">
			<img src="images/thumbs-down.png" alt="thumbs-down" width=10% height=10%/>
		</div>
		<script>
		var mydiv = document.getElementById("side");
		var radius = Math.min(mydiv.offsetWidth,mydiv.offsetHeight)/2;
		var width = mydiv.offsetWidth,
			height = mydiv.offsetHeight,
			color = d3.scale.category20c();
		//to set the eye's position
		var topThing=height* .500 -(radius*.5);
		document.getElementById("eye").style.top=topThing+"px";
		//to set the clock's position
		topThing=height* .500 +(radius*.1);
		document.getElementById("clock").style.top=topThing+"px";
		//to set the thumbs-up's position
		var leftThing=width* .500 +(radius*.3);
		document.getElementById("thumbs-up").style.left=leftThing+"px";
		//to set the thumbs-down's position
		leftThing=width* .500 -(radius*.5);
		document.getElementById("thumbs-down").style.left=leftThing+"px";
		
		var svg = d3.select(side).append("svg")
			.attr("width", width)
			.attr("height", height)
		  .append("g")
			.attr("transform", "translate(" + width / 2 + "," + height * .5005 + ")");

		var partition = d3.layout.partition()
			.sort(null)
			.size([2 * Math.PI, radius * radius])
			.value(function(d) { return 1; });

		var arc = d3.svg.arc()
			.startAngle(function(d) { return d.x; })
			.endAngle(function(d) { return d.x + d.dx; })
			.innerRadius(function(d) { return Math.sqrt(d.y); })
			.outerRadius(function(d) { return Math.sqrt(d.y + d.dy); });

		d3.json("sunburst.json", function(error, root) {
		  var path = svg.datum(root).selectAll("path")
			  .data(partition.nodes)
			.enter().append("path")
			  .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
			  .attr("d", arc)
			  .style("stroke", "#fff")
			  .style("fill", function(d) { return getSectionColor(d.name); })
			  .style("fill-rule", "evenodd")
			  .each(stash);

		  d3.selectAll("input").on("change", function change() {
			var value = this.value === "count"
				? function() { return 1; }
				: function(d) { return d.size; };

			path
				.data(partition.value(value).nodes)
			  .transition()
				.duration(1500)
				.attrTween("d", arcTween);
		  });
		});

		// Stash the old values for transition.
		function stash(d) {
		  d.x0 = d.x;
		  d.dx0 = d.dx;
		}

		// Interpolate the arcs in data space.
		function arcTween(a) {
		  var i = d3.interpolate({x: a.x0, dx: a.dx0}, a);
		  return function(t) {
			var b = i(t);
			a.x0 = b.x;
			a.dx0 = b.dx;
			return arc(b);
		  };
		}

		function getSectionColor(n){
		  switch(n){
			case "For":
			  return "#111774";
			case "ForAgreed":
			  return "#010533";
			case "ForDisagreed":
			  return "#3965ae";
			case "Against":
			  return "#ff0000";
			case "AgainstAgreed":
			  return "#85000D";
			case "AgainstDisagreed":
			  return "#FF6B6B";
			case "Ambivalent":
			  return "#c0c0c0";    
			case "AmbivalentAgreed":
			  return "#615656";
			case "AmbivalentDisagreed":
			  return "#a8bba8";
			default:
			  return "#000";
		  }
		}

		d3.select(self.frameElement).style("height", height + "px");

		</script>
	</div>-->
	
	<br />
	
	<div id="content">
		<div id="sunburst" style="height:50%;top:0%;position:absolute;">
			<div id="eye" onclick="refreshBubbles()" style="position:absolute;width:20%;height:10%">
			<img src="images/eye.png" alt="eye" width=100% height=100%/>
			</div>
			<div id="clock"onclick="refreshBubbles()"style="position:absolute;width:10%;height:10%">
				<img src="images/clock.png" alt="clock" width=100% height=100%/>
			</div>
			<div id="thumbs-up"onclick="refreshBubbles()"style="position:absolute;width:10%;height:10%">
				<img src="images/thumbs-up.png" alt="thumbs-up" width=100% height=100%/>
			</div>
			<div id="thumbs-down"onclick="refreshBubbles()"style="position:absolute;width:10%;height:10%">
				<img src="images/thumbs-down.png" alt="thumbs-down" width=100% height=100%/>
			</div>
			<script>
				var mydiv = document.getElementById("sunburst");
				mydiv.style.width="30%";
				mydiv.style.left="50%";
				//weird super complicated way of making the image right in the middle (because just doing left:50%, places the object too far right, since there is no "middle:50%" function)
				mydiv.style.left=(parseInt(mydiv.style.left.replace(/%/,""))) -(parseInt(mydiv.style.width.replace(/%/,""))/2)+"%";
				mydiv=document.getElementById("eye");
				mydiv.style.left=50 -(parseInt(mydiv.style.width.replace(/%/,""))/2)+"%";
				mydiv=document.getElementById("clock");
				mydiv.style.left=50 -(parseInt(mydiv.style.width.replace(/%/,""))/2)+"%";
				mydiv=document.getElementById("thumbs-up");
				mydiv.style.top=50 -(parseInt(mydiv.style.width.replace(/%/,"")))/2+"%";
				mydiv=document.getElementById("thumbs-down");
				mydiv.style.top=50 -(parseInt(mydiv.style.width.replace(/%/,"")))/2+"%";
				//end of weird stuff
				
				mydiv = document.getElementById("sunburst");
				var radius = Math.min(mydiv.offsetWidth,mydiv.offsetHeight)/2;
				var width = mydiv.offsetWidth,
					height = mydiv.offsetHeight,
					color = d3.scale.category20c();
				//to set the eye's position
				var topThing=height* .500 -(radius*.5);
				document.getElementById("eye").style.top=topThing+"px";
				//to set the clock's position
				topThing=height* .500 +(radius*.3);
				document.getElementById("clock").style.top=topThing+"px";
				//to set the thumbs-up's position
				var leftThing=width* .500 +(radius*.2);
				document.getElementById("thumbs-up").style.left=leftThing+"px";
				//to set the thumbs-down's position
				leftThing=width* .500 -(radius*.5);
				document.getElementById("thumbs-down").style.left=leftThing+"px";
				
				var svg = d3.select(sunburst).append("svg")
					.attr("width", width)
					.attr("height", height)
				  .append("g")
					.attr("transform", "translate(" + width / 2 + "," + height * .5005 + ")");

				var partition = d3.layout.partition()
					.sort(null)
					.size([2 * Math.PI, radius * radius])
					.value(function(d) { return 1; });

				var arc = d3.svg.arc()
					.startAngle(function(d) { return d.x; })
					.endAngle(function(d) { return d.x + d.dx; })
					.innerRadius(function(d) { return Math.sqrt(d.y); })
					.outerRadius(function(d) { return Math.sqrt(d.y + d.dy); });

				d3.json("sunburst.json", function(error, root) {
				  var path = svg.datum(root).selectAll("path")
					  .data(partition.nodes)
					.enter().append("path")
					  .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
					  .attr("d", arc)
					  .style("stroke", "#fff")
					  .style("fill", function(d) { return getSectionColor(d.name); })
					  .style("fill-rule", "evenodd")
					  .each(stash);

				  d3.selectAll("input").on("change", function change() {
					var value = this.value === "count"
						? function() { return 1; }
						: function(d) { return d.size; };

					path
						.data(partition.value(value).nodes)
					  .transition()
						.duration(1500)
						.attrTween("d", arcTween);
				  });
				});

				// Stash the old values for transition.
				function stash(d) {
				  d.x0 = d.x;
				  d.dx0 = d.dx;
				}

				// Interpolate the arcs in data space.
				function arcTween(a) {
				  var i = d3.interpolate({x: a.x0, dx: a.dx0}, a);
				  return function(t) {
					var b = i(t);
					a.x0 = b.x;
					a.dx0 = b.dx;
					return arc(b);
				  };
				}

				function getSectionColor(n){
				  switch(n){
					case "For":
					  return "#111774";
					case "ForAgreed":
					  return "#010533";
					case "ForDisagreed":
					  return "#3965ae";
					case "Against":
					  return "#ff0000";
					case "AgainstAgreed":
					  return "#85000D";
					case "AgainstDisagreed":
					  return "#FF6B6B";
					case "Ambivalent":
					  return "#c0c0c0";    
					case "AmbivalentAgreed":
					  return "#615656";
					case "AmbivalentDisagreed":
					  return "#a8bba8";
					default:
					  return "#000";
				  }
				}

				d3.select(self.frameElement).style("height", height + "px");

			</script>
		</div>
		<div id="bubbles" style="width:100%;height:50%;top:50%;;position:absolute;">
			<script>
				<!--Bubble generation : http://bl.ocks.org/mbostock/4063269-->
				
				function refreshBubbles(){
				
					var mydiv = document.getElementById("bubbles");					
					var diameter = Math.min(mydiv.offsetWidth,mydiv.offsetHeight)-100,
					format = d3.format(",d"),
					color = d3.scale.category20c();

					mydiv.style.width=diameter+"px";
					mydiv.style.left=document.getElementById("content").offsetWidth/2-diameter/2 +"px";
					var bubble = d3.layout.pack()
						.sort(null)
						.size([diameter-100, diameter-100])
						.padding(1.5);

					var svg = d3.select(document.getElementById("bubbles")).append("svg")
						.attr("width", diameter)
						.attr("height", diameter)
						.attr("class", "bubble");

					d3.json("flare.json", function(error, root) {
					  var node = svg.selectAll(".node")
						  .data(bubble.nodes(classes(root))
						  .filter(function(d) { return !d.children; }))
						.enter().append("g")
						  .attr("class", "node")
						  .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

					  node.append("title")
						  .text(function(d) { return d.className + ": " + format(d.value); });

					  node.append("circle")
						  .attr("r", function(d) { return d.r; })
						  .style("fill", function(d) { return getSectionColor(d.packageName); }); 

					  node.append("text")
						  .attr("dy", ".3em")
						  .style("text-anchor", "middle")
						  .text(function(d) { return d.className.substring(0, d.r / 3); });
					});
				}

				// Returns a flattened hierarchy containing all leaf nodes under the root.
				function classes(root) {
				  var classes = [];

				  function recurse(name, node) {
					if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
					else classes.push({packageName: name, className: node.name, value: node.size});
				  }

				  recurse(null, root);
				  return {children: classes};
				}
				//only need one colouring funciton. we already have one in the sunburst - it appears to affect all d3 things
				/*function getSectionColor(n){
					switch(n){
						case "For":
							return "#00CC33";
							break; 
						case "Against":
							return "#D80000";
							break; 
						case "Ambivalent":
							return "#D8D8D8";
							break; 
					}
				}*/
				d3.select(self.frameElement).style("height", diameter + "px");

			</script>
		</div>
	</div>

	<br />
	<div id="footer">
	<div  style="padding-top:1%;color:black;font-size:2.5vh;"><!--a dummy to vertically align text, since vertical-align doesn't seem to work-->
		
		Bill 60
	</div>
	</div>
</div>
</body>
</html>